<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Core API and iota.rs</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../theme/custom.css">
        <link rel="stylesheet" href="../theme/tabbed-code-blocks.css">

    </head>
    <body>
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = null;
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><li class="part-title">Welcome</li><li class="spacer"></li><li class="chapter-item expanded "><a href="../index.html">üëã About: IOTA for Flutter</a></li><li class="chapter-item expanded "><a href="../welcome/what-youll-get.html">üíª What you'll get</a></li><li class="chapter-item expanded "><a href="../welcome/when-you-are-js-developer/index.html">‚òï When you are JS developer</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../welcome/when-you-are-js-developer/dart-vs.-javascript.html">Dart vs. JavaScript</a></li></ol></li><li class="chapter-item expanded "><a href="../welcome/which-resources-you-need.html">‚ú® Which resources you need</a></li><li class="chapter-item expanded "><a href="../welcome/how-to-get-the-most-out-of-this-tutorial.html">üßê How to get the most out of this tutorial</a></li><li class="chapter-item expanded "><a href="../welcome/what-does-this-tutorial-not-contain.html">‚ö†Ô∏è What does this tutorial NOT contain?</a></li><li class="spacer"></li><li class="chapter-item expanded affix "><li class="part-title">IOTA SDK Library</li><li class="spacer"></li><li class="chapter-item expanded "><a href="../iota-sdk-library/index.html">READ ME !</a></li><li class="spacer"></li><li class="chapter-item expanded affix "><li class="part-title">Fundamentals</li><li class="spacer"></li><li class="chapter-item expanded "><a href="../fundamentals/android-studio/index.html">Android Studio</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../fundamentals/android-studio/set-up.html">Set up</a></li><li class="chapter-item expanded "><a href="../fundamentals/android-studio/essentials.html">Essentials</a></li></ol></li><li class="chapter-item expanded "><a href="../fundamentals/xcode/index.html">Xcode</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../fundamentals/xcode/set-up.html">Set up</a></li><li class="chapter-item expanded "><a href="../fundamentals/xcode/essentials.html">Essentials</a></li></ol></li><li class="chapter-item expanded "><a href="../fundamentals/flutter/index.html">Flutter</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../fundamentals/flutter/set-up.html">Set up</a></li><li class="chapter-item expanded "><a href="../fundamentals/flutter/essentials.html">Essentials</a></li></ol></li><li class="chapter-item expanded "><a href="../fundamentals/rust/index.html">Rust</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../fundamentals/rust/set-up.html">Set up</a></li><li class="chapter-item expanded "><a href="../fundamentals/rust/essentials.html">Essentials</a></li><li class="chapter-item expanded "><a href="../fundamentals/rust/project-structure.html">Project Structure</a></li><li class="chapter-item expanded "><a href="../fundamentals/rust/rust-docs.html">Create Rust Docs</a></li><li class="chapter-item expanded "><a href="../fundamentals/rust/dependencies-and-features.html">Dependencies and Features</a></li></ol></li><li class="chapter-item expanded "><a href="../fundamentals/ide-visual-studio-code/index.html">IDE: Visual Studio Code</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../fundamentals/ide-visual-studio-code/set-up.html">Set up</a></li><li class="spacer"></li></ol></li><li class="chapter-item expanded "><li class="part-title">Overview</li><li class="spacer"></li><li class="chapter-item expanded "><a href="../overview/how-everything-works-together/index.html">üí° How everything works together</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../overview/how-everything-works-together/workflow.html">üí° Workflow</a></li><li class="chapter-item expanded "><a href="../overview/how-everything-works-together/handling-code-changes.html">üí° Handling code changes</a></li></ol></li><li class="chapter-item expanded "><a href="../overview/cross-compiling.html">üè≠ Cross-Compiling</a></li><li class="chapter-item expanded "><a href="../overview/flutter-rust-bridge/index.html">üåÅ Flutter Rust Bridge</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../overview/flutter-rust-bridge/about.html">üåÅ About</a></li><li class="chapter-item expanded "><a href="../overview/flutter-rust-bridge/features.html">üåÅ Language translations</a></li><li class="chapter-item expanded "><a href="../overview/flutter-rust-bridge/alternatives.html">üåÅ Alternatives?</a></li></ol></li><li class="chapter-item expanded "><a href="../overview/iota-libraries/index.html">üìö IOTA libraries</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../overview/iota-libraries/iota-sdk.html">üìö IOTA SDK and identity.rs</a></li><li class="chapter-item expanded "><a href="../overview/iota-libraries/iota-wallet-identity.html">üìö iota.rs, wallet.rs and identity.rs</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../overview/iota-libraries/library-versions.html">üìö Library Versions</a></li></ol></li><li class="chapter-item expanded "><a href="../overview/iota-libraries/deeper-insights.html">üìö Deeper Insights</a></li><li class="spacer"></li></ol></li><li class="chapter-item expanded "><li class="part-title">Building without IOTA</li><li class="spacer"></li><li class="chapter-item expanded "><a href="../building-without-iota/flutter-only.html">Flutter only</a></li><li class="chapter-item expanded "><a href="../building-without-iota/flutter-and-rust/index.html">Flutter and Rust</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../building-without-iota/flutter-and-rust/frb-example-app/index.html">FRB Template App - modified Workflow</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../building-without-iota/flutter-and-rust/frb-example-app/common-part-1.html">1. Initialization and Rust part</a></li><li class="chapter-item expanded "><a href="../building-without-iota/flutter-and-rust/frb-example-app/android-instructions.html">2. Android instructions</a></li><li class="chapter-item expanded "><a href="../building-without-iota/flutter-and-rust/frb-example-app/common-macos-ios.html">3. Common macOS/iOS instructions</a></li><li class="chapter-item expanded "><a href="../building-without-iota/flutter-and-rust/frb-example-app/macos-instructions.html">4. macOS instructions</a></li><li class="chapter-item expanded "><a href="../building-without-iota/flutter-and-rust/frb-example-app/ios-instructions.html">5. iOS instructions</a></li><li class="chapter-item expanded "><a href="../building-without-iota/flutter-and-rust/frb-example-app/common-part-2.html">6. Flutter part</a></li><li class="chapter-item expanded "><a href="../building-without-iota/flutter-and-rust/frb-example-app/build-run.html">7. Build and run</a></li></ol></li><li class="chapter-item expanded "><a href="../building-without-iota/flutter-and-rust/logging-example-app/index.html">Logging Example App</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../building-without-iota/flutter-and-rust/logging-example-app/resources.html">Resources</a></li><li class="spacer"></li></ol></li></ol></li><li class="chapter-item expanded "><li class="part-title">Building a Simple App</li><li class="spacer"></li><li class="chapter-item expanded "><a href="../building-a-simple-app/whats-the-result.html">What's the result?</a></li><li class="chapter-item expanded "><a href="../building-a-simple-app/core-api.html" class="active">Core API and iota.rs</a></li><li class="chapter-item expanded "><a href="../building-a-simple-app/init-flutter-app-and-setup-frb.html">Init Flutter App and Setup FRB</a></li><li class="chapter-item expanded "><a href="../building-a-simple-app/building-for-android.html">Building for Android</a></li><li class="chapter-item expanded "><a href="../building-a-simple-app/building-for-macos.html">Building for macOS</a></li><li class="chapter-item expanded "><a href="../building-a-simple-app/building-for-ios.html">Building for iOS</a></li><li class="spacer"></li><li class="chapter-item expanded affix "><li class="part-title">Building a Comprehensive App</li><li class="spacer"></li><li class="chapter-item expanded "><a href="../building-a-comprehensive-app/whats-the-result.html">What's the result?</a></li><li class="chapter-item expanded "><a href="../building-a-comprehensive-app/locations-on-the-filesystem.html">Locations on the filesystem</a></li><li class="chapter-item expanded "><a href="../building-a-comprehensive-app/init-flutter-app-and-setup-frb.html">Init Flutter App and Setup FRB</a></li><li class="chapter-item expanded "><a href="../building-a-comprehensive-app/rust-code/index.html">Rust Code for Examples</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../building-a-comprehensive-app/rust-code/example-1.html">Example 1: Get Node Information</a></li><li class="chapter-item expanded "><a href="../building-a-comprehensive-app/rust-code/example-2.html">Example 2: Generate Mnemonics</a></li><li class="chapter-item expanded "><a href="../building-a-comprehensive-app/rust-code/example-3/index.html">Example 3: Create Wallet Account</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../building-a-comprehensive-app/rust-code/example-3/libsodium.html">Libsodium library for Android</a></li></ol></li><li class="chapter-item expanded "><a href="../building-a-comprehensive-app/rust-code/example-4.html">Example 4: Generate Address</a></li><li class="chapter-item expanded "><a href="../building-a-comprehensive-app/rust-code/example-5.html">Example 5: Request Funds</a></li><li class="chapter-item expanded "><a href="../building-a-comprehensive-app/rust-code/example-6.html">Example 6: Check Balance</a></li><li class="chapter-item expanded "><a href="../building-a-comprehensive-app/rust-code/example-7.html">Example 7: Create DID</a></li><li class="chapter-item expanded "><a href="../building-a-comprehensive-app/rust-code/bin-to-hex.html">Bin to Hex</a></li></ol></li><li class="chapter-item expanded "><a href="../building-a-comprehensive-app/building-for-android.html">Building for Android</a></li><li class="chapter-item expanded "><a href="../building-a-comprehensive-app/building-for-macos.html">Building for macOS</a></li><li class="chapter-item expanded "><a href="../building-a-comprehensive-app/building-for-ios.html">Building for iOS</a></li><li class="spacer"></li><li class="chapter-item expanded affix "><li class="part-title">Building a Comprehensive App using IOTA SDK</li><li class="spacer"></li><li class="chapter-item expanded "><a href="../building-a-comprehensive-app-with-iota-sdk/motivation.html">Motivation</a></li><li class="chapter-item expanded "><a href="../building-a-comprehensive-app-with-iota-sdk/building-for-android.html">Building for Android</a></li><li class="chapter-item expanded "><a href="../building-a-comprehensive-app-with-iota-sdk/building-for-ios/index.html">Building for iOS</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../building-a-comprehensive-app-with-iota-sdk/building-for-ios/libsodium.html">Libsodium library for iOS</a></li><li class="spacer"></li></ol></li><li class="chapter-item expanded "><li class="part-title">MQTT Chat App</li><li class="spacer"></li><li class="chapter-item expanded "><a href="../mqtt-app/whats-the-result.html">What's the result?</a></li><li class="chapter-item expanded "><a href="../mqtt-app/overview.html">Overview</a></li><li class="chapter-item expanded "><a href="../mqtt-app/android.html">Android</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title"></h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="core-api-and-iotars"><a class="header" href="#core-api-and-iotars">Core API and iota.rs</a></h1>
<hr />
<p>Seamless Connection: Utilize iota-client for easy integration with Core API of the node, to access the tangle.</p>
<hr />
<p>In this chapter, I will demonstrate how I utilize an official example from <code>iota-client</code> as a template to create a function for my own Rust API.</p>
<h2 id="context"><a class="header" href="#context">Context</a></h2>
<p>As a developer, you are accustomed to querying REST APIs. The Shimmer and IOTA nodes provide such APIs. At a higher level, the library crate <code>iota-client</code> supports us as Rust developers by encapsulating certain calls and exposing them as functions. This relationship has already been shown in the movie clip &quot;How everything works together&quot; starting from minute 2:53.</p>
<p>In the video you can see the Swagger page of a node with its endpoints. Then it is demonstrated that you could make individual endpoint calls using Postman.</p>
<p><strong>Ultimately, the iota-client of iota.rs takes over the task to communicate with the node's API.</strong></p>
<iframe 
    class="video"  
    src="https://www.youtube.com/embed/P0Kh0DSaddA?start=172" 
    title="Core API and iota.rs" 
    frameborder="0" 
    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" 
    allowfullscreen>
</iframe>
<p><a href="https://editor.swagger.io/?url=https://raw.githubusercontent.com/iotaledger/tips/main/tips/TIP-0025/core-rest-api.yaml" target="_blank">üëâ ¬† IOTA Core REST API</a></p>
<p>The structure of a block including a tag and a message is displayed when you expand the accordion with the POST endpoint <code>/api/core/v2/blocks</code>.</p>
<figure style="margin:0;border: 1px solid green;"><img src="../assets/block-tagged-data.jpg" alt="Block with tagged data payload"><figcaption style="font-size: 0.8em;text-align:center;"><p style="margin: 4px 0 7px 0;">Block with tagged data payload</p></figcaption></figure>
<h2 id="posting-a-block-into-the-tangle"><a class="header" href="#posting-a-block-into-the-tangle">Posting a Block into the tangle</a></h2>
<p>To post a block of this kind using the features provided by the <code>iota-client</code> crate, we can utilize the example <em>client/examples/block/004_example_tagged_data.rs</em> as a template. Let's first try it out.</p>
<iframe 
    class="video"  
    src="https://www.youtube.com/embed/JeLW9HzKvXI" 
    title="Running Rust examples" 
    frameborder="0" 
    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" 
    allowfullscreen>
</iframe>
<p>Here's the source code:</p>
<pre><code class="language-rust ignore">// iota.rs -&gt; client/examples/block/004_example_tagged_data.rs

// Copyright 2021 IOTA Stiftung
// SPDX-License-Identifier: Apache-2.0

//! This example sends a block with a tagged data payload.
//! Run: `cargo run --example block_tagged_data --release -- [NODE URL]`.

use iota_client::{block::payload::Payload, Client, Result};

#[tokio::main]
async fn main() -&gt; Result&lt;()&gt; {
    // Take the node URL from command line argument or use one from env as default.
    let node_url = std::env::args().nth(1).unwrap_or_else(|| {
        // This example uses dotenv, which is not safe for use in production.
        dotenv::dotenv().ok();
        std::env::var(&quot;NODE_URL&quot;).unwrap()
    });

    // Create a client with that node.
    let client = Client::builder().with_node(&amp;node_url)?.finish()?;

    // Create and send the block with tag and data.
    let block = client
        .block()
        .with_tag(b&quot;Hello&quot;.to_vec())
        .with_data(b&quot;Tangle&quot;.to_vec())
        .finish()
        .await?;

    println!(&quot;{block:#?}\n&quot;);

    if let Some(Payload::TaggedData(payload)) = block.payload() {
        println!(
            &quot;Tag: {}&quot;,
            String::from_utf8(payload.tag().to_vec()).expect(&quot;found invalid UTF-8&quot;)
        );
        println!(
            &quot;Data: {}&quot;,
            String::from_utf8(payload.data().to_vec()).expect(&quot;found invalid UTF-8&quot;)
        );
    }

    println!(
        &quot;\nBlock with tag and data sent: {}/block/{}&quot;,
        std::env::var(&quot;EXPLORER_URL&quot;).unwrap(),
        block.id()
    );

    Ok(())
}</code></pre>
<blockquote>
<p>If you run the example <em>block_tagged_data</em> using the command line with argument <em>[NODE_URL]</em>, e.g. by</p>
<p><code>cargo run --example block_tagged_data --release -- &quot;https://api.shimmer.network&quot;</code></p>
<p>then you will get an error message indicating that the EXPLORER_URL is missing. This is because the environment variables have not been loaded. To fix that, include <code>dotenv::dotenv().ok();</code> in the line before the last <code>println!</code> command.</p>
</blockquote>
<h3 id="understanding-the-code"><a class="header" href="#understanding-the-code">Understanding the code</a></h3>
<p>The two important lines in the code above are the ones for</p>
<ol>
<li>creating a client instance that can operate and exchange data with the tangle using a node, and</li>
<li>generating the block, which includes sending the block to the Tangle in the finish method.</li>
</ol>
<p>I want to exemplify how a client instance is created in <code>iota-client</code>. A static method of the <code>Client</code> struct first creates a <code>ClientBuilder</code>. The builder allows dynamic configuration of the client by chaining multiple methods to override default values. Only when the <code>finish()</code> method is called, the client instance is returned from the builder.</p>
<figure style="margin:0;border: 1px solid green;"><img src="../assets/client-builder.jpg" alt="ClientBuilder used to configure a client instance"><figcaption style="font-size: 0.8em;text-align:center;"><p style="margin: 4px 0 7px 0;">ClientBuilder used to configure a client instance </p></figcaption></figure>
<blockquote>
<p>The principle used for creating instances with builders is frequently employed in <code>iota-client</code>, such as with the <code>Node_Manager</code>, <code>Blocks</code> (used in the code above), or <code>Addresses</code>. It's like the builder taking Lego blocks from a storage shelf and assembling them together.</p>
</blockquote>
<p>The next important code line is:</p>
<pre><code class="language-rust ignore">// Create and send the block with tag and data.
    let block = client
        .block()
        .with_tag(b&quot;Hello&quot;.to_vec())
        .with_data(b&quot;Tangle&quot;.to_vec())
        .finish()
        .await?;</code></pre>
<p>At first, a ClientBlockBuilder is created by calling the function <code>client.block()</code>. This function can be found in <code>client/src/api/block_builder/high_level.rs</code>.</p>
<blockquote>
<p>If you wonder why this <code>client</code> function is not defined in the <code>client.rs</code> file let me remind you that in Rust, <strong>you can provide implementations for your struct throughout the crate!</strong> This language feature is used in <em>iota.rs</em>.</p>
</blockquote>
<p>By utilizing the <em>with_*</em> functions in <code>client/src/api/block_builder/mod.rs</code> a tag and a data payload are added to the block.</p>
<p>The function <code>finish()</code> examines the block configuration. As a tag is included, the <code>finish_tagged_data()</code> function is called next, and finally forwards to <code>finish_block()</code>. This last function not only creates a block instance but it also posts the block to the node api and the tangle using <code>client.post_block_raw()</code>. Do you find the definition for this <code>post</code> function? Tipp: there's another <code>impl Client {...}</code> in <code>client/src/node_api/core/routes.rs</code>.</p>
<blockquote>
<p>In my view, whenever the <code>finish()</code> method is invoked, blocks are <em>invariably</em> sent to the tangle. Hence, there is no need for any additional <code>client.post_block()</code> functions to be called. Therefore, in my opinion, the explicit call mentioned in <strong>the Wiki description of <a href="https://wiki.iota.org/shimmer/iota.rs/how_tos/post_block/">Post a Data Block</a> is incorrect</strong>:</p>
<pre><code class="language-rust ignore">    // Create the block.
    let block = client.block().finish().await?;
    // Post the block.
    let block_id = client.post_block(&amp;block).await?;  // &lt;-- Why !?</code></pre>
</blockquote>
<h2 id="transforming-the-example-into-an-api-function"><a class="header" href="#transforming-the-example-into-an-api-function">Transforming the example into an API function</a></h2>
<p>The question addressed here is: How can I create a public function in my own Rust API that is exposed to Flutter through our cross-compiled library?</p>
<p>There are some peculiarities in the official example.</p>
<ul>
<li>The example contains an <em>async main</em> function.</li>
<li>NODE_URL and EXPLORER_URL are retrieved either from the .env file or from the command line.</li>
<li>The result is printed in the console.</li>
</ul>
<p>So, how can we convert it into our API function?</p>
<p>At first, we should replace the <code>main()</code> function by a method to be exposed, let's say:</p>
<pre><code class="language-rust ignore">pub fn publish_tagged_data_block(...) {
    ...
}</code></pre>
<p>It's an absolute must to make the function public, otherwise, it won't be exposed to the outside world.</p>
<p>Next up, our function needs a little something extra. It should accept parameters for the tag and the message. And in return, it should gracefully provide you with the blockId. So, let's add some flavor to our function:</p>
<pre><code class="language-rust ignore">pub fn publish_tagged_data_block(tag: String, message: String) -&gt; Result&lt;String&gt; {
    ...
}</code></pre>
<p>Ah, decisions, decisions! While we could add the node_url as input parameter to our function, I've decided to take matters into my own hands. I'll go ahead and hard code this URL, based on the assumption we made in our <a href="whats-the-result.html">User Story</a>.</p>
<pre><code class="language-rust ignore">pub fn publish_tagged_data_block(tag: String, message: String) -&gt; Result&lt;String&gt; {
    let node_url: String = String::from(&quot;https://api.shimmer.network&quot;);

    ...
}</code></pre>
<p>Inside the function, we need to establish a similar structure to the <code>#[tokio::main]</code> statement shown in the example. The Flutter-Rust-Bridge User Guide has published an article discussing this specific topic, which can be found at the following link: <a href="https://cjycode.com/flutter_rust_bridge/article/async_in_rust.html">Async in Rust</a>. Based on my experience, I recommend adopting approach 2, where we explicitly create a new Tokio runtime and use its <code>block_on</code> function to execute the future until it finishes its execution. This approach has proven to provide a reliable and effective solution.</p>
<blockquote>
<p><strong>What is Tokio?</strong></p>
<p>Oh, the confusion! Let's clear things up! While &quot;Tokio&quot; might sound like the capital of Japan, it's actually an <em>asynchronous runtime</em> for Rust. Just like Tokyo is bustling with activity, Tokio handles the execution of asynchronous tasks in your program. It ensures that your API requests are executed asynchronously, so your program doesn't sit there twiddling its thumbs. With Tokio, you get a whole package of features and abstractions, including support for Rust's <code>async/await</code> syntax and futures, making your asynchronous code more readable and approachable.</p>
</blockquote>
<p>So, let's make some adjustments to the code:</p>
<pre><code class="language-rust ignore">pub fn publish_tagged_data_block(tag: String, message: String) -&gt; Result&lt;String&gt; {
    let node_url: String = String::from(&quot;https://api.shimmer.network&quot;);

    let rt = Runtime::new().unwrap();
    rt.block_on(async {
        ...
    })
}</code></pre>
<p>Don't forget to add the following dependencies to <code>Cargo.toml</code>:</p>
<pre><code class="language-rust ignore">[dependencies]
tokio = { version = &quot;1.28.2&quot;, features = [&quot;full&quot;] }
anyhow = { version = &quot;1.0.71&quot; }</code></pre>
<p>Now we're almost done. It's time to add the core functionalities which are the two lines to create the client and the block, and to send it.</p>
<pre><code class="language-rust ignore">pub fn publish_tagged_data_block(tag: String, message: String) -&gt; Result&lt;String&gt; {
    let node_url: String = String::from(&quot;https://api.shimmer.network&quot;);

    let rt = Runtime::new().unwrap();
    rt.block_on(async {
        // Create a client with that node.
        let client = Client::builder().with_node(&amp;node_url)?.finish()?;

        // Create and send the block with tag and data.
        let block = client
            .block()
            .with_tag(tag.into_bytes())
            .with_data(message.into_bytes())
            .finish()
            .await?;

        ...
    })
}</code></pre>
<p>To convert a Rust String into a vector of byte literals (Vec<u8>), you can use the <code>String::into_bytes</code> method.</p>
<p>The only missing part is returning the block_id as String, so we try this:</p>
<pre><code class="language-rust ignore">pub fn publish_tagged_data_block(tag: String, message: String) -&gt; Result&lt;String&gt; {
    let node_url: String = String::from(&quot;https://api.shimmer.network&quot;);

    let rt = Runtime::new().unwrap();
    rt.block_on(async {
        // Create a client with that node.
        let client = Client::builder().with_node(&amp;node_url)?.finish()?;

        // Create and send the block with tag and data.
        let block = client
            .block()
            .with_tag(tag.into_bytes())
            .with_data(message.into_bytes())
            .finish()
            .await?;

        let block_id:BlockId = block.id();

        Ok(block_id.to_string())
    })
}</code></pre>
<p><code>Block</code> and <code>BlockId</code> are defined in package <code>types</code> of iota.rs, in the folder <code>types/src/block</code>. To avoid that the compiler complains, you need to add the related paths to your <code>api.rs</code>.</p>
<h2 id="rust-code-for-your-simple-app"><a class="header" href="#rust-code-for-your-simple-app">Rust code for your Simple App</a></h2>
<p>In summary, here are the steps you need to take to create an API within your Rust library project, which is located within your Flutter project.</p>
<h3 id="cargotoml"><a class="header" href="#cargotoml">Cargo.toml</a></h3>
<p>Add these libraries to the existing ones.</p>
<pre><code class="language-rust ignore">[dependencies]
iota-client = { version = &quot;2.0.1-rc.7&quot;, default-features = false, features = [ &quot;tls&quot; ] }

tokio = { version = &quot;1.28.2&quot;, features = [&quot;full&quot;] }
anyhow = { version = &quot;1.0.71&quot; }</code></pre>
<h3 id="apirs"><a class="header" href="#apirs">api.rs</a></h3>
<pre><code class="language-rust ignore">use iota_client::{block::BlockId, Client};
use tokio::runtime::Runtime;
use anyhow::Result;

pub fn publish_tagged_data_block(tag: String, message: String) -&gt; Result&lt;String&gt; {
    let node_url: String = String::from(&quot;https://api.shimmer.network&quot;);

    let rt = Runtime::new().unwrap();
    rt.block_on(async {
        // Create a client with that node.
        let client = Client::builder().with_node(&amp;node_url)?.finish()?;

        // Create and send the block with tag and data.
        let block = client
            .block()
            .with_tag(tag.into_bytes())
            .with_data(message.into_bytes())
            .finish()
            .await?;

        let block_id:BlockId = block.id();

        Ok(block_id.to_string())
    })
}</code></pre>
<h3 id="librs"><a class="header" href="#librs">lib.rs</a></h3>
<pre><code class="language-rust ignore">mod api;</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../building-a-simple-app/whats-the-result.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="../building-a-simple-app/init-flutter-app-and-setup-frb.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../building-a-simple-app/whats-the-result.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="../building-a-simple-app/init-flutter-app-and-setup-frb.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <!-- Livereload script (if served using the cli tool) -->
        <script>
            const wsProtocol = location.protocol === 'https:' ? 'wss:' : 'ws:';
            const wsAddress = wsProtocol + "//" + location.host + "/" + "__livereload";
            const socket = new WebSocket(wsAddress);
            socket.onmessage = function (event) {
                if (event.data === "reload") {
                    socket.close();
                    location.reload();
                }
            };

            window.onbeforeunload = function() {
                socket.close();
            }
        </script>



        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->
        <script src="../theme/tabbed-code-blocks.js"></script>


    </div>
    </body>
</html>
